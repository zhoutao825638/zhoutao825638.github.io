<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>/Users/tao/Documents/Gridea/output</id>
    <title>Gridea</title>
    <updated>2019-07-18T11:24:46.952Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="/Users/tao/Documents/Gridea/output"/>
    <link rel="self" href="/Users/tao/Documents/Gridea/output/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>/Users/tao/Documents/Gridea/output/images/avatar.png</logo>
    <icon>/Users/tao/Documents/Gridea/output/favicon.ico</icon>
    <rights>All rights reserved 2019, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[1111]]></title>
        <id>/Users/tao/Documents/Gridea/output/post/1111/index.html</id>
        <link href="/Users/tao/Documents/Gridea/output/post/1111/index.html">
        </link>
        <updated>2019-07-18T11:24:29.000Z</updated>
        <content type="html"><![CDATA[<p>ByteBuf å®ç°äº†ReferenceCounted æ¥å£ï¼Œå®ç°äº†å¼•ç”¨è®¡æ•°æ¥å£ï¼Œè¯¥æ¥å£çš„retain(int) æ–¹æ³•ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ä½¿ç”¨äº†è‡ªæ—‹é”æ¥ç¡®ä¿æ“ä½œå®‰å…¨ï¼Œé‚£ä¹ˆé€‰æ‹©äº†æ¯”è¾ƒé‡è¦çš„å®ç°ç±»<code>AbstractReferenceCountedByteBuf</code> æ¥æŸ¥çœ‹è¿™ä¸€ç‰¹æ€§.</p>
<p>åœ¨JDK 1.5 ä¹‹åï¼ŒJDKçš„å¹¶å‘åŒ…æä¾›äº†Atomic* çš„ç›¸å…³ç±»ï¼Œæ¥å¸®åŠ©å¼€å‘è€…æ›´å¥½çš„å®Œæˆå¹¶å‘æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬å­¦ä¹ ä½¿ç”¨CASæ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼ŒCASå°±æ˜¯ComposeAndSet,ä¸­æ–‡å«ä¹‰ï¼Œæ¯”è¾ƒAndæ›´æ–°,æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­,å…·ä½“çš„è¯´æ˜åœ¨æ³¨é‡Šä¸­ï¼</p>
<pre><code class="language-java">static class Increment {

    // volatile ä¿è¯äº†çº¿ç¨‹å¯è§æ€§ï¼Œä½†æ˜¯æ²¡æœ‰ä¿è¯æŒ‰æˆå®‰å…¨æ€§
    private volatile int i;

    // å£°æ˜CASçš„æŠ½è±¡ç±»
    private static AtomicIntegerFieldUpdater&lt;Increment&gt; updater;

    static {
      // é€šè¿‡é™æ€æ–¹æ³•åˆ›å»ºCASçš„å…·ä½“å®ä¾‹
      // ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºç»´æŠ¤çš„Integeræ‰€åœ¨çš„ç±»çš„class
      // ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç»´æŠ¤çš„Integerå˜é‡çš„åç§°
      updater = AtomicIntegerFieldUpdater.newUpdater(Increment.class, &quot;i&quot;);
    }

    /**
     * æ„é€ åˆå§‹åŒ–å‡½æ•°
     *
     * @param i
     */
    public Increment(int i) {
      this.i = i;
    }

    /** è‡ªå¢ä¸€ä¸ª */
    public void increment() {
      increment(1);
    }

    /**
     * é‡è½½è‡ªå¢æ–¹æ³•
     *
     * &lt;p&gt;è¯¥æ–¹æ³•å…·ä½“å®ç°äº†CASçš„ä»£ç é€»è¾‘ï¼Œé‡åœ¨å‡åœ¨ä¸‹é¢çš„forå¾ªç¯ä¸­
     *
     * @param increment
     */
    public void increment(int increment) {
      // åˆ›å»ºä¸€ä¸ªæ­»å¾ªç¯ï¼ŒcompareAndSetæ£€æŸ¥ä¸é€šè¿‡çš„æ—¶å€™ï¼Œé‡æ–°è·å–æ–°çš„å€¼å°è¯•æ›´æ–°
      for (; ; ) {
        // ä¿å­˜å½“å‰çº¿ç¨‹æ›´æ–°çš„å€¼çš„çŠ¶æ€
        int oldI = this.i;
        final int newValue = oldI + increment;
        // æ ¡éªŒå€¼æ˜¯å¦æ›´æ–°å®Œæˆ
        if (newValue &lt;= increment) {
          throw new IllegalArgumentException(&quot;éæ³•çš„å‚æ•°å¼‚å¸¸&quot;);
        }
        // å¦‚æœCASæ›´æ–°å®Œæˆï¼Œåˆ™é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™æ‰“å°é‡è¯•æ—¥å¿—
        if (updater.compareAndSet(this, oldI, newValue)) {
          break;
        }
        System.out.println(&quot;å‘ç”Ÿå¤šçº¿ç¨‹å¹¶å‘,CASæ­£å¸¸é‡æ–°å°è¯•&quot;);
      }
    }
  }
</code></pre>
<p>å®ç°äº†è‡ªå¢çš„CASä»£ç ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªMyRunnable ç»§æ‰¿Runnable åœ¨run() æ–¹æ³•ä¸­å®ç°Increment å®ä¾‹çš„è‡ªå¢ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-java">  static class MyRunnable implements Runnable {

    private Increment increment;
    
    public MyRunnable(Increment increment) {
      this.increment = increment;
    }

    @Override
    public void run() {
      increment.increment();
    }
  }

</code></pre>
<p>åœ¨main() æ–¹æ³•ä¸­æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªIncrement ç¤ºä¾‹å¯¹è±¡ï¼Œæ„é€ å‚æ•°ä¼ 1ï¼Œç„¶ååˆ›å»º50ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶å¯åŠ¨ï¼Œè§‚å¯Ÿæœ€ç»ˆçš„ç»“æœ, å¤šæ¬¡è¿è¡Œè§‚å¯Ÿæ˜¯å¦èƒ½å®ç°çº¿ç¨‹å®‰å…¨.</p>
<pre><code class="language-java">  public static void main(String[] args) throws InterruptedException {
    Increment increment = new Increment(1);
    for (int i = 0; i &lt; 50; i++) {
      new Thread(new MyRunnable(increment)).start();
    }
    // å»¶æ—¶4s, ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§å®Œæˆåï¼Œè¾“å‡ºi
    TimeUnit.SECONDS.sleep(4);
    System.out.println(increment.i);
  }
</code></pre>
<p>æœ€åè¾“å‡ºç»“æœä¸º51ï¼Œå¯è§CAS èƒ½å¤Ÿå®ç°å¤šçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œç›¸å¯¹äºRelockCountå’Œé‡é‡çº§çš„synchronized å„æœ‰å„çš„é€‚åˆåœºæ™¯ï¼Œä¸‹é¢å›åˆ°Nettyçš„è‡ªæ—‹é”çš„é—®é¢˜ä¸Šæ¥ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ä»£ç å’Œä¸Šé¢çš„ç¤ºä¾‹æ˜¯ç±»ä¼¼çš„ï¼ŒNettyä¾é è¿™ä¸ªæ–¹æ³•æ¥å®ŒæˆByteBufçš„å¼•ç”¨è®¡æ•°ï¼Œç¡®ä¿å¤šçº¿ç¨‹æ“ä½œByteBufçš„æ—¶å€™å¼•ç”¨è®¡æ•°ä¸ä¼šå‡ºç°å¤šçº¿ç¨‹çš„é—®é¢˜,</p>
<blockquote>
<p>ä¸‹é¢çš„ä»£ç æ˜¯å¼•ç”¨äº†Netty5 çš„ io.netty.buffer.AbstractReferenceCountedByteBuf ç±»çš„éƒ¨åˆ†ä»£ç ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ä¸‹è½½è¯¥æ¡†æ¶çš„æºç ï¼Œæ‰¾åˆ°è¯¥æ–‡ä»¶çœ‹ä¸€ä¸‹ã€‚</p>
</blockquote>
<pre><code class="language-java">    private static final AtomicIntegerFieldUpdater&lt;AbstractReferenceCountedByteBuf&gt; refCntUpdater;
    static {
        AtomicIntegerFieldUpdater&lt;AbstractReferenceCountedByteBuf&gt; updater =
                PlatformDependent.newAtomicIntegerFieldUpdater(AbstractReferenceCountedByteBuf.class, &quot;refCnt&quot;);
        if (updater == null) {
            updater = AtomicIntegerFieldUpdater.newUpdater(AbstractReferenceCountedByteBuf.class, &quot;refCnt&quot;);
        }
        refCntUpdater = updater;
    }

    @Override
    public ByteBuf retain(int increment) {
        if (increment &lt;= 0) {
            throw new IllegalArgumentException(&quot;increment: &quot; + increment + &quot; (expected: &gt; 0)&quot;);
        }
        for (;;) {
            int refCnt = this.refCnt;
            if (refCnt == 0) {
                throw new IllegalReferenceCountException(0, increment);
            }
            if (refCnt &gt; Integer.MAX_VALUE - increment) {
                throw new IllegalReferenceCountException(refCnt, increment);
            }
            if (refCntUpdater.compareAndSet(this, refCnt, refCnt + increment)) {
                break;
            }
        }
        return this;
    }
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>/Users/tao/Documents/Gridea/output/post/hello-gridea/index.html</id>
        <link href="/Users/tao/Documents/Gridea/output/post/hello-gridea/index.html">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="http://hvenotes.fehey.com/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>ğ–¶ğ—‚ğ—‡ğ–½ğ—ˆğ—ğ—Œ</strong> æˆ– <strong>ğ–¬ğ–ºğ–¼ğ–®ğ–²</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>